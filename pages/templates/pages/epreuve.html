<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8">
    <title>Question 1</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'question.css' %}">
    <link rel="stylesheet" href="{% static 'navbar.css' %}">
  </head>
  <body>
    {% include 'partials/navbar.html' %}
    <div class="container">
      <div class="context-box">
        <h1 class="titre-principal">Mission : Trouve la planque du poseur de bombe !</h1>
        {% if joueur_id == 1 %}
            <h2>Pour rappel, les indices sont...</h2>
            <div class="calcul">
                Maintenant que nous avons assez d'indice, d√©codont les pour la localisation de la planque.
            </div>

        {% elif joueur_id == 2 %}
            <h2>Pour rappel, les indices sont...</h2>
            <div class="calcul">
                Maintenant que nous avons assez d'indice, d√©codont les pour la localisation de la planque.
            </div>

        {% elif joueur_id == 3 %}
            <h2>Pour rappel, les indices sont...</h2>
            <div class="calcul">
                Maintenant que nous avons assez d'indice, d√©codont les pour la localisation de la planque.
            </div>
        {% endif %}

        <div class="reponse-box">
            <input type="text" id="reponse" name="reponse" placeholder="Ta r√©ponse ici...">
            <button id="submit-reponse" class="btn-valider">Valider</button>
        </div>
        <p>(Format r√©ponse attendu : Nom monument JJ/MM 00:00)</p>

        <div class="erreur" style="display:none; color:red;">
            <p>Mauvaise r√©ponse ‚ùå ‚Äî essaye encore !</p>
        </div>

      <button class="bouton-aide">üí°</button>

      <div id="popup-indice" class="popup" style="display:none;">
        <div class="popup-content">
          <span id="close-popup">&times;</span>
          <p>Utiliser ton indice ? (Tu n‚Äôen as qu‚Äôun seul !)</p>
          <button id="confirm-indice" class="btn-oui">Oui</button>
          <button id="cancel-indice" class="btn-non">Non</button>
        </div>
      </div>
      <div class="indice" style="display:none;">
        <p>Indice : </p>
      </div>
    </div>

<script>
const helpBtn = document.querySelector('.bouton-aide');
const popup = document.getElementById('popup-indice');
const closePopup = document.getElementById('close-popup');
const confirmBtn = document.getElementById('confirm-indice');
const cancelBtn = document.getElementById('cancel-indice');
const indice = document.querySelector('.indice');

const submitBtn = document.getElementById('submit-reponse');
const reponse = document.getElementById('reponse');
const resultat = document.querySelector('.resultat');
const erreur = document.querySelector('.erreur');
const reponseBox = document.querySelector('.reponse-box');
const popupAttaque = document.getElementById('popup-attaque');
const closeAttaque = document.getElementById('close-attaque');

let joueurId = localStorage.getItem('joueurId') || '{{ joueur_id }}';
let questionActuelle = localStorage.getItem('questionActuelle') || 1;
let indiceUtilise = localStorage.getItem('indiceUtilise') === 'true';

const urlMatch = window.location.pathname.match(/question(\d+)\/\d+\//);
if (urlMatch) {
    const currentQuestion = parseInt(urlMatch[1]);
    if (currentQuestion !== parseInt(questionActuelle)) {
        window.location.href = `/question${questionActuelle}/${joueurId}/`;
    }
}

// Emp√™che l‚Äôusage multiple de l‚Äôindice
if (indiceUtilise) {
    helpBtn.disabled = true;
    helpBtn.style.opacity = 0.5;
    indice.style.display = 'none';
}

// --- POPUP AIDE ---
helpBtn.addEventListener('click', () => {
    popup.style.display = 'flex';
});

closePopup.addEventListener('click', () => popup.style.display = 'none');
cancelBtn.addEventListener('click', () => popup.style.display = 'none');

confirmBtn.addEventListener('click', () => {
    indice.style.display = 'block';
    helpBtn.disabled = true;
    helpBtn.style.opacity = 0.5;
    popup.style.display = 'none';
    reponseBox.style.display = 'block';
    localStorage.setItem('indiceUtilise', true);
});

submitBtn.addEventListener('click', () => {
    const valeur = reponse.value.trim().toLowerCase();

    if (valeur === 'a') { //marina bay sands hotel 08/07 16:00
        window.location.href = `/victoire/${joueurId}/`;

    } else {
        erreur.style.display = 'block';
    }
});
</script>
</body>
</html>