<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8">
    <title>Question 1</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'question.css' %}">
    <link rel="stylesheet" href="{% static 'navbar.css' %}">
  </head>
  <body>
    {% include 'partials/navbar.html' %}
    <div class="container">
      <div class="context-box">
        <div id="enonce">
        <div class="page-layout">
            <img src="{% static 'ascii.png' %}" alt="Table ASCII" class="ascii-image">
        <div id="enonce">
        <div class="question-content">
            <h1 class="titre-principal">Trouvez le monument vis√©, la date et l'heure de l'attaque dans le temps imparti gr√¢ce au indice laiss√© en code ascii d√©cimaux !</h1>
            {% if joueur_id == 1 %}
                <h2>D√©code l'indice ci-dessous gr√¢ce au tableau de conversion pour trouver l'heure √† laquelle l'attaque est pr√©vue!</h2>
                <div>
                    <p>104 97 98 105 116 97 110 116 115 32 224 32 83 101 111 117 108 32 101 110 32 109 105 108 108 105 111 110 32 61 32 104 101 117 114 101</p> <!--habitants √† Seoul en million = heure-->   
                </div>
            {% elif joueur_id == 2 %}
                <h2>D√©code l'indice ci-dessous gr√¢ce au tableau de conversion pour trouver le monument vis√© par l'attaque!</h2>
                <div>
                     <p>67 111 110  99 117 101  32 112  97 114  32  67 104 114 105 115 116 111 112 104 101 114  32  87 114 101 110</p>  <!--Concu par Christopher Wren-->
                </div>
            {% elif joueur_id == 3 %}
                <h2>Ta mission est de trouver la date de l'attaque, en t'aidant du tableau √† gauche d√©chiffre l'indice en code ascii !</h2>
                <div>
                    <p>104 117 105 116 32 104 101 117 114 101 32 116 114 101 110 116 101 45 110 101 117 102</p> <!--vingt-sept juillet-->
                </div>
            {% endif %}
            
            <div class="reponse-box">
              <input type="text" id="reponse" name="reponse" placeholder="Ta r√©ponse ici...">
              <button id="submit-reponse" class="btn-valider">Valider</button>
            </div>
            <p>(Format r√©ponse attendu : Nom monument JJ/MM 00:00)</p>
            <div class="erreur" style="display:none; color:red;">
                <p>Mauvaise r√©ponse ‚ùå ‚Äî essaye encore !</p>
            </div>
        </div>
    </div>
    </div>
    </div>

    <!-- Message de f√©licitations -->
    <div id="felicitation" style="display:none; text-align:center; margin-top:30px;">
        <h2 style="color:#00ff99; text-shadow:0 0 10px #00ff99;">üéâ Bravo, mission accomplie !</h2>
    </div>

    <!-- Message d'indice -->
    <div id="indice-suivant" style="display:none; text-align:center; margin-top:20px;">
        <h2>
            Nous avons re√ßu une information : La taille des arbres Supertree Grove<br>
            On commence √† se rapprocher de leur planque!
        </h2>
    </div>

    <div id="popup-attaque" class="popup" style="display:none;">
        <div class="popup-content">
            <p>On a re√ßu d'autres informations sur une attaque potentielle !</p>
            <button id="close-attaque">Fermer</button>
        </div>
    </div>

    <div class="erreur" style="display:none; color:red;">
        <p>Mauvaise r√©ponse ‚ùå ‚Äî essaye encore !</p>
    </div>
</div>

      <button class="bouton-aide">üí°</button>

      <div id="popup-indice" class="popup" style="display:none;">
        <div class="popup-content">
          <span id="close-popup">&times;</span>
          <p>Vous poss√©dez un seul indice pour toute la partie, voulez vous vraiment l'utiliser</p>
          <button id="confirm-indice" class="btn-oui">Oui</button>
          <button id="cancel-indice" class="btn-non">Non</button>
        </div>
      </div>
      <div class="indice" style="display:none;">
        {% if joueur_id == 1 %}
            <p>habitants √† Seoul en million = heure</p>
        {% elif joueur_id == 2 %}
            <p>Concu par Christopher Wren</p>
        {% elif joueur_id == 3 %}
            <p>vingt-sept juillet</p>
        {% endif %}
      </div>
      </div>
    </div>

<script>
const helpBtn = document.querySelector('.bouton-aide');
const popup = document.getElementById('popup-indice');
const closePopup = document.getElementById('close-popup');
const confirmBtn = document.getElementById('confirm-indice');
const cancelBtn = document.getElementById('cancel-indice');
const indice = document.querySelector('.indice');

const submitBtn = document.getElementById('submit-reponse');
const reponse = document.getElementById('reponse');
const resultat = document.querySelector('.resultat');
const erreur = document.querySelector('.erreur');
const reponseBox = document.querySelector('.reponse-box');
const popupAttaque = document.getElementById('popup-attaque');
const closeAttaque = document.getElementById('close-attaque');

let joueurId = localStorage.getItem('joueurId') || '{{ joueur_id }}';
let questionActuelle = localStorage.getItem('questionActuelle') || 1;
let indiceUtilise = localStorage.getItem('indiceUtilise') === 'true';

const urlMatch = window.location.pathname.match(/question(\d+)\/\d+\//);
if (urlMatch) {
    const currentQuestion = parseInt(urlMatch[1]);
    if (currentQuestion !== parseInt(questionActuelle)) {
        window.location.href = `/question${questionActuelle}/${joueurId}/`;
    }
}

if (indiceUtilise) {
    helpBtn.disabled = true;
    helpBtn.style.opacity = 0.5;
    indice.style.display = 'none';
}

// POPUP AIDE
helpBtn.addEventListener('click', () => {
    popup.style.display = 'flex';
});

closePopup.addEventListener('click', () => popup.style.display = 'none');
cancelBtn.addEventListener('click', () => popup.style.display = 'none');

confirmBtn.addEventListener('click', () => {
    indice.style.display = 'block';
    helpBtn.disabled = true;
    helpBtn.style.opacity = 0.5;
    popup.style.display = 'none';
    reponseBox.style.display = 'block';
    localStorage.setItem('indiceUtilise', true);
});

submitBtn.addEventListener('click', () => {

    const valeur = reponse.value.trim().toLowerCase();

    if (valeur === 'cath√©drale saint-paul 27/07 09:00') {

        // Cacher l'√©nonc√© (titre, image, texte)
        document.getElementById('enonce').style.display = 'none';

        // Masquer la zone de r√©ponse et les erreurs si visibles
        reponseBox.style.display = 'none';
        erreur.style.display = 'none';

        // Afficher le message de f√©licitations
        document.getElementById('felicitation').style.display = 'block';

        // Augmenter la question pour la suite
        questionActuelle = parseInt(questionActuelle) + 1;
        localStorage.setItem('questionActuelle', questionActuelle);

        // Afficher le message de f√©licitations
        const felicitation = document.getElementById('felicitation');
        const indiceSuivant = document.getElementById('indice-suivant');
        felicitation.style.display = 'block';

        // Apr√®s 3 secondes, afficher le nouvel indice
        setTimeout(() => {
            felicitation.style.display = 'none';
            indiceSuivant.style.display = 'block';
        }, 3000);

        // Apr√®s quelques secondes, afficher le popup attaque
        setTimeout(() => {
            popupAttaque.style.display = 'flex';
        }, 4000);

    } else {
        erreur.style.display = 'block';
    }
});
//FERMETURE DU POPUP D‚ÄôATTAQUE
closeAttaque.addEventListener('click', () => {
    popupAttaque.style.display = 'none';
    window.location.href = `/question${questionActuelle}/${joueurId}/`;
});
</script>
</body>
</html>